---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVUXNycVM5UFZibGFBQTJBOWI3T3ZXS2x1K3Vzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd01USXdNakV4TURBd1doY05NakV3TVRFNU1qRXgKTURBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUNzNHhoOTUwNzE0MnNJZzBqVzV1V2M3cWpMaUZBTUd2ejhoeGgvMTR4OTlDN2k5Q2lPV2l1MQpSNXhOV1VWUDJuSG1HL2IyQzFkaEtTMjN2YWNVOXVIeWJLM3Q3YWZvZnJ6SzlHS0xFeUpCVDgrRmJaOVpSd3ZzCmpUUitZNFFLWmRNVzA0YXJnOTVIWDAwc3FFV25xVUdqbFhGRFo0aGZoeGFVbzIzTEVSaEVPS202Zk8zaTBBTjEKMWJDOXhidEtjdjNyU2hVSGQ4RzFlbzdCdFFQSU9vc2lCblA4L3E5aEQ4NWd1ZnExb2I0WkdNa0M2TFZULytkZQpEQ08zRzc0VS9PTzJwSVArWWJSNmJKUGNBS2dzbGh3K00wUG5CcWxzcGNPY0RJTGE3dFBDUXIyTnVwcmc5MlJ1Cmc4Zlp0WWN3aTZDZER0a2drZEpZbnlCNHNjQXdFUXQ1QWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlI0MzZMdkNmV2YvMzdQNzRiMi9kelBUbWRndnpBZkJnTlZIU01FR0RBV2dCUU42T3FzCkU2ZCtwUS9PMW83QmVZelpMS1FQcGpBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBSHhrOG9mSlNPbzg0ZFE0dEtTRWpvVGhjSUNubkdKWnluWGZ1Vzh5dVpsUQpxU1ZUMzN6VHUrczYyTUNVblVuaURIcXBBU1o5c2xkKzgzVHk5ZWxSZ3g0YjJjMmRyeVN1eXNQUnZaaEwrS3hFCk9ycjd3bzJ1WDRSQkxDSlBGUTJxNTBRc1ZoR1kvT01LUTIrdDhndUw5S2FPZ1M2K1pSdWxaUHBldnZucFFkb2MKS3NJTkN4UFBSY3g3ME1ZOTBQMXNFeWJzSlArOFk5dTY1NGl4T1dmK2tLTlFTanFZbzlMSnNoSVJ4WmhUSnRSNAp0WTVsU2hYNVQvNkhTRWpQbGc4TERHZ2ZlajF5Y2RtNW5OMkExSE1KWEJOWnFYQkpua2kycHNRMUJiYy9iZEo2CjgwWTB0VWxKMzBadzhkdE9odWNjZ1dwZW1nazBLTWZKSGttR1VuRWxoelE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBck9NWWZlZE85ZU5yQ0lOSTF1YmxuTzZveTRoUURCcjgvSWNZZjllTWZmUXU0dlFvCmpsb3J0VWVjVFZsRlQ5cHg1aHYyOWd0WFlTa3R0NzJuRlBiaDhteXQ3ZTJuNkg2OHl2UmlpeE1pUVUvUGhXMmYKV1VjTDdJMDBmbU9FQ21YVEZ0T0dxNFBlUjE5TkxLaEZwNmxCbzVWeFEyZUlYNGNXbEtOdHl4RVlSRGlwdW56dAo0dEFEZGRXd3ZjVzdTbkw5NjBvVkIzZkJ0WHFPd2JVRHlEcUxJZ1p6L1A2dllRL09ZTG42dGFHK0dSakpBdWkxClUvL25YZ3dqdHh1K0ZQemp0cVNEL21HMGVteVQzQUNvTEpZY1BqTkQ1d2FwYktYRG5BeUMydTdUd2tLOWpicWEKNFBka2JvUEgyYldITUl1Z25RN1pJSkhTV0o4Z2VMSEFNQkVMZVFJREFRQUJBb0lCQVFDVmlHWnFuMklnTXU4awprY2l5ZDBzcURSSloyRERFQjZQQkYyZ05Tdlh0Q3dKeXNoTlI3SlBaVzNMSlErazdSQWszcWdCVWwwS2dldWxiCi91RkF0TGlBNFpjZUwyd0hIM2RUWTBUSVhXaEhiU3hrajRnL3c3K0FmakZsRDlYbzJHRlhZT1VkL0JTSlR0aUYKUTVYYmlmMkg2MzNuZXVqdEZ2NWsyV1hoT1l2dmxGWmcwSWJhTmFvWG15clkvSW5BN28yeW1uRngvaUU5Y3lNawozS2wxZmlLMG9GUnJNY0FsZW5MWTdER3lVV05uSS9lbXhRanp3eUcvcnZicHZCdmpWZWF2UjgwOGNwQy9xNnlRCkw3UzR1aW8wa2Roby9GbzJwb3FnMkJKY0NLRGt6SU5EVmhoalk0aXlJZTVlUXNSRGxHN3dhSk4veEplcHA5V1YKNGM1Njc5ekJBb0dCQU1jcmxtNllBTUR0Z29saGs4eW9Ec0o0NFc4ZjVFNThsSXNqYkVOTGxyZU81QkhpK3ptRQpqRTlPbUJ0U0E3dnhzYUpicFhGR1laVE1ab1RnejBuS2ljUU5YK0Y5ZVBnNVdmaHpDcmduVkkzWXJheGttcE81CkhkZEpiRmNtSFNFbFZwNXBZQ1gxSmJIMGF1MEFKeXloRWJoZkVicjBmV3JDbzV0K2hzT1U5Nk8xQW9HQkFONDMKcHF6RWg1Z3NXWkxtbUNIRkY5ZGNlaWNqM0dzWVNoTG12bml2eEJKYlB0QWFHQk5iSi9XUCtsV2RGaGpnbTlvcgo3ZklmNGNDcHE1YVlwYUpYVnc4OEZ2YkdwQ01OWjVvbFpXbTVFQXR5Mm9lQ1ZCUjFsUnJYMDBNbmdDOFh4c2ZvCkVHakdWYUE5NUhiRXZYQWVta0FXdDYwWjljVFQyNHcycTZtY2tlczFBb0dBTnVOblFMRTVPL0g0a0gzSXFwVUMKQkV3bDdHY0FselMwQnloSzlMekhHMjBRbzNGSFJOR25qVStla2FEbmtJc0tKakZWaGNNY3IxSXBTcU5kM1BzcApQbE5sUWhJL0hVRkk3elJkRnVVWDQwTjhrVTdrWHFPY2VyRXNYMVFNb1E3V01TL2ZKSGJMM1ovN083ZFlGRytMCkg2RnJsSGMrZlFhSTZoaFRjV0VEWWlVQ2dZQXRreHBTK3FlWWxSZjE0ZWMzbmRXSzdNTjh2WVVhVGN2N1htbVkKRk94UW0zZ2hkQWlXQjY4RlZQY1JrZnNUTlJXaHhEcXoyc2dSSEhzOWtxYjl5WTNvYVBtSXVTcTJxYXdpMkNLWgpjVVFTSlFjZW5hTWk0dzZtaDdjallibVBidi9zeGZKL21wVzdISlo3cVZQMDU4SFkvUS9FcDd0WkY5NUNQb0FzCmRCa1ZOUUtCZ1FDME5JYWVjbTI5bThNVElpWEIxYzRVU0NvL0hjaWsrTE56NE1mTU56Tlcya0FIdkVnV3VxUHQKVDAxcTYvMnhzeGdjVW04UEx4cDdkeG4xd1dFNnloZnR0NGphWTNCVmhlMWVEYUoxMi9NVVVWRzdxK244OGJPcgpZUG1lWFRiZWdOUVlaTCt0WDBSYW9EZzcxOGw5bSszbExHTUpua1MxQTBDVkZjcWFsWGYyRnc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque
